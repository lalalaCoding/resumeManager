<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>후기 관리하기</title>
	<!-- 페이지명 왼쪽에 아이콘 삽입 -->
	<link rel="shortcut icon" href="image/icon/logo.png">
	<!-- css -->
	<link href="css/epilogueInfo.css" rel="stylesheet" type="text/css"/>
</head>
<body>
	<div th:replace="~{common/header :: header}"></div>
	
	<br/>
		
	<div id="wrapper">
		<div><!-- 왼쪽 공백 --></div>
		<div><!-- 왼쪽 메뉴 공간 -->
			<ul class="nav flex-column">
				<li class="nav-item">
					<a th:if="${info == 'general'}" class="nav-link disabled" aria-current="page" href="#">일반 정보</a>
			    	<a th:unless="${info == 'general'}" class="nav-link active" href="infoPage.me?info=general">일반 정보</a> 
			    	<!-- <a class="nav-link disabled" aria-current="page" href="#">일반 정보</a> -->
			  	</li>
			  	<li class="nav-item">
			    	<a th:if="${info == 'epilogue'}" class="nav-link disabled" aria-current="page" href="#">나의 후기</a>
			    	<a th:unless="${info == 'epilogue'}" class="nav-link active" href="infoPage.me?info=epilogue">나의 후기</a>
			  	</li>
			  	<li class="nav-item">
			    	<a th:if="${info == 'pwd'}" class="nav-link disabled" aria-current="page" href="#">비밀번호 변경하기</a>
			    	<a th:unless="${info == 'pwd'}" class="nav-link active" href="infoPage.me?info=epilogue">비밀번호 변경하기</a>
			  	</li>
			  	<li class="nav-item">
			    	<a th:if="${info == 'chat'}" class="nav-link disabled" aria-current="page" href="#">나의 채팅</a>
			    	<a th:unless="${info == 'chat'}" class="nav-link active" href="infoPage.me?info=epilogue">나의 채팅</a>
			  	</li>
			</ul>
		</div>
		<div><!-- 컨텐츠 출력 공간 -->
			<div class="row row-cols-1 row-cols-md-3 g-4">
				
				<div class="col" th:each="rh : ${rhList}">
			    	<div class="card h-100" style="width: 18rem;">
				  		<div class="card-body">
				    		<h5 class="card-title">[[${rh.companyName}]]</h5>
				    		<p class="card-text">
				    			<span>
					    			<th:block th:if="${rh.resumeCareer == 0}">[신입]</th:block>
					    			<th:block th:if="${rh.resumeCareer == 1}">[1년차]</th:block>
					    			<th:block th:if="${rh.resumeCareer == 3}">[3년차]</th:block>
					    			<th:block th:if="${rh.resumeCareer == 5}">[5년차]</th:block>
				    			</span>
				    			<span class="companySpan">[[${rh.companyType.typeName}]]</span>
				    			<br/>
				    			지원날짜 : [[${rh.resumeDate}]]
			    			</p>
				  		</div>
				  		<!-- 지원이력에 대한 후기가 있는지 없는 검사하여 출력 -->
				  		<div class="card-footer">
		      				<input type="hidden" name="resumeNo" th:value="${rh.resumeNo}"/>
			      			<small class="text-body-secondary" th:unless="${tree[rh.resumeNo] == 0}">
			      				<button type="button" class="btn btn-primary readBtn">Go Read</button>
			      			</small>
			      			<small class="text-body-secondary" th:if="${tree[rh.resumeNo] == 0}">
			      				<button type="button" class="btn btn-primary writeBtn">Go Write</button>
			      			</small>
	    		  		</div>
					</div>
			  	</div>
				
				
				<div class="col">
			    	<div class="card h-100" style="width: 18rem;">
				  		<div class="card-body">
				    		<h5 class="card-title">회사명</h5>
				    		<p class="card-text">
				    			[경력] [회사 직군]<br/>
				    			[지원 날짜]
			    			</p>
				    
				  		</div>
				  		<div class="card-footer">
			      			<small class="text-body-secondary">
			      				<a href="#" class="btn btn-primary">Go write</a>
			      			</small>
	    		  		</div>
					</div>
			  	</div>
			</div>
			
			
			<nav aria-label="Page navigation" th:with="loc=${loc}"> <!-- loc = 요청url -->
			    <ul class="pagination">
				    <li class="page-item">
				    	<a class="page-link" th:if="${pi.currentPage > 1}" th:href="@{${loc}(page=${pi.currentPage - 1})}" aria-label="Previous">
				        	<span aria-hidden="true">&lt;</span>
				        </a>
				      	<a class="page-link disabled" th:unless="${pi.currentPage > 1}" href="#" aria-label="Previous">
				        	<span aria-hidden="true">&lt;</span>
				        </a>
				    </li>
				    <li class="page-item" th:each="p : ${#numbers.sequence(pi.startPage, pi.endPage)}">
				    	<a class="page-link" th:if="${pi.currentPage != p}" th:href="@{${loc}(page=${p})}">[[${p}]]</a>
				    	<a class="page-link disabled" th:unless="${pi.currentPage != p}" href="#">[[${p}]]</a>
			    	</li>
				    <li class="page-item">
				        <a class="page-link" th:if="${pi.currentPage < pi.maxPage}" th:href="@{${loc}(page=${pi.currentPage + 1})}" aria-label="Next">
				        	<span aria-hidden="true">&gt;</span>
				        </a>
				    	<a class="page-link disabled" th:unless="${pi.currentPage < pi.maxPage}" href="#" aria-label="Next">
				        	<span aria-hidden="true">&gt;</span>
				        </a>
				    </li>
			    </ul>
			</nav>
		</div>
		<div><!-- 오른쪽 공백 --></div>
	</div>
	
	<br/>
	
	<div th:replace="~{common/footer :: footer}"></div>
	
	
	<!-- 후기 출력용 모달 -->
	<div class="modal fade" id="epilogueModal" tabindex="-1" aria-labelledby="epilogueModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h1 class="modal-title fs-5" id="epilogueModalLabel">후기 작성 또는 조회</h1>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        <form>
	          <div class="mb-3">
	            <label for="modalCompanyName" class="col-form-label">CompanyName:</label>
	            <input type="text" class="form-control" id="modalCompanyName">
	          </div>
	          <div class="mb-3">
	            <label for="message-text" class="col-form-label">Epilogue Message:</label>
	            <input type="hidden" name="resumeNo" value=""/>
	            <textarea class="form-control" id="message-text" rows="10" style="resize:none;"></textarea>
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
	        <button type="button" class="btn btn-primary">Submit</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	
	<script>
		window.onload = () => {
			const readBtnList = $('.readBtn');
			const writeBtnList = $('.writeBtn');
			
			//후기 작성 이벤트 (시작)
			writeBtnList.on('click', function() {
				const resumeNo = $(this).parent().prev().val();
				//text() : 공백를 포함해서 요소 내부 텍스트를 읽어온다
				const companyName = $(this).parent().parent().prev().find('.companySpan').text();
				
				document.querySelector('#epilogueModalLabel').textContent = '후기 작성';
				document.querySelector('#modalCompanyName').value = companyName;
				
				
				
				
				$('#epilogueModal').modal('show');
				
				
			});
			//후기 작성 이벤트 (끝)
		}
	</script>
</body>
</html>